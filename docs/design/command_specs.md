# Slash Command 仕様書

## 共通ポリシー

- すべて **Slash Command** として実装する。
  - 日次・週次サマリなど、あえて履歴を残したいものだけ通常メッセージ。
- コマンドは、基本的に「**1ユーザ＝自分**」を前提とした設計にする。
  - `user_id` は DB 上では汎用的に持つが、現状は自分専用サーバー運用。
- すべてのコマンドは、**エラー時も「ユーザに意味がわかるメッセージ」**を返す。

---

## 1. 記録・整理系コマンド

### 1-1. `/memo`

#### 概要
- 軽いメモを一時的に溜めるための機能。
- 「あとで整理するためのメモ置き場」のイメージ。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `add`  | `text` | string | ○ | 登録するメモ本文 |
| `list` | `limit` | integer | × | 取得件数（デフォルト10、最大50） |
| `clear` | `confirm` | boolean | × | true のときのみ全削除実行 |

#### 振る舞い

- `/memo add text:"買い物リスト作る"`  
  - `memos` テーブルに `user_id, content, created_at` を INSERT。
  - 応答：`✅ メモを登録しました: 「買い物リスト作る」`
- `/memo list limit:5`  
  - 最新順に最大5件取得。
  - 応答：embed or 整形テキストで一覧表示。
- `/memo clear confirm:true`  
  - 該当ユーザの memos を全削除。
  - 応答：`🗑 メモを全削除しました（N件）。`

---

### 1-2. `/todo`

#### 概要
- シンプルな ToDo リスト管理。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `add`  | `text`   | string   | ○ | ToDo 内容 |
| `done` | `id`     | integer  | ○ | 完了にする ToDo ID |
| `list` | `filter` | string   | × | `"open" / "done" / "all"`（デフォルト `"open"`） |

#### 振る舞い

- `/todo add text:"Router再起動"`  
  - `todos` テーブルに `status="open"` で追加。
  - 応答：`✅ ToDoを追加しました (#id): 「Router再起動」`
- `/todo done id:3`  
  - `id=3` の ToDo を `status="done"` に更新、`done_at` を現在時刻に。
  - 応答：`✅ ToDo #3 を完了にしました。`
- `/todo list filter:"open"`  
  - 未完了のみ一覧表示（id, 内容, 作成日）。

---

### 1-3. `/clip`

#### 概要
- URL やリンクを軽くクリップしておく機能。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `add`  | `url`  | string | ○ | クリップするURL |
|        | `tag`  | string | × | カテゴリ用タグ |
|        | `note` | string | × | 補足メモ |
| `list` | `tag`  | string | × | 指定タグのみ表示（未指定なら全部） |

#### 振る舞い

- `/clip add url:"https://example.com" tag:"shop" note:"気になるやつ"`  
- `/clip list tag:"shop"` → `shop` タグ付きのみ表示。

---

### 1-4. `/idea`

#### 概要
- 思いつきやアイデアのメモ用（メモと似ているが、長期保管前提）。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `add`  | `text` | string | ○ | アイデア本文 |
|        | `tag`  | string | × | カテゴリ |
| `list` | `tag`  | string | × | 指定タグのみ |
|        | `mode` | string | × | `"latest" / "random"`（デフォルト `"latest"`） |

※ 実装時は `mode` をオプションにするか `/idea random` のようにサブコマンド分けるかは要検討。

---

### 1-5. `/log`

#### 概要
- 1日の出来事や作業のログを残すためのコマンド。
- `/daily` / `/weekly` 集計の元データ。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `add`  | `rating` | integer | × | 0〜5 の気分/満足度（未入力なら null） |
|        | `text`   | string  | ○ | ログ本文 |
| `list` | `since`  | string  | × | `"today" / "yesterday" / "7d"` など（後で具体化） |

---

## 2. 状態・作業系コマンド

### 2-1. `/status`

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `set`  | `text` | string | ○ | Botプレゼンスの表示テキスト |
| `show` | なし   | -      | - | 現在のプレゼンスを表示 |

#### 振る舞い
- `/status set text:"開発中"` → `client.user.setPresence` で反映。
- `/status show` → 現在の活動名/statusを返信。

---

### 2-2. `/pin`

#### 概要
- 直近のBotメッセージ、または指定IDのメッセージをピン留めする補助。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `last`       | なし          | -      | - | 直近のBotメッセージをピン |
| `message`    | `message_id` | string | ○ | 指定メッセージIDをピン |

※ 権限的に、自分専用チャンネル前提。

---

### 2-3. `/roll`

#### 概要
- サイコロ的なランダム値を返す。

#### 引数仕様

| 引数 | 型 | 必須 | 説明 |
|------|----|------|------|
| `formula` | string | ○ | `"XdY"` 形式（例: `"1d6"`, `"2d20"`） |

#### 振る舞い
- `/roll formula:"2d6"` → `n` 回 `1..Y` の整数乱数を振り、合計や内訳を表示。

---

### 2-4. `/session`

#### 概要
- 作業セッション（ポモドーロ的なもの）の開始・終了・状態確認。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `start`  | `name` | string | × | セッション名（未指定なら自動名） |
| `end`    | なし   | -      | - | 現在のセッションを終了 |
| `status` | なし   | -      | - | セッション状態を表示 |

#### 振る舞い

- `/session start name:"日報作成"`  
  - `sessions` に `started_at` でINSERT。
- `/session end`  
  - 最新の未終了セッションを `ended_at` で更新し、`duration_min` を計算。
  - 同時に `/log add` 相当のレコードを自動生成してもよい（要検討）。
- `/session status`  
  - 進行中のセッションがあれば残り時間 or 経過時間を表示。

---

## 3. サマリ・定期系コマンド

### 3-1. `/daily`

#### 概要
- 当日の ToDo/Log/Session をまとめてサマリ出力。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `now` | なし | - | - | 今すぐ日次サマリを生成 |

#### 自動実行
- `node-cron` で毎日 `config.daily_time` に実行。
- 出力先は `config.summary_channel_id` に設定されたチャンネル。

---

### 3-2. `/weekly`

#### 概要
- 1週間分のログとセッションを集計した週次サマリ。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `now` | なし | - | - | 今すぐ週次サマリを生成 |

#### 自動実行
- `node-cron` で `config.weekly_day` + `config.daily_time` に実行。

---

## 4. 設定系コマンド

### 4-1. `/config`

#### 概要
- Bot動作のカスタマイズ（時間帯・チャンネルなど）。

#### サブコマンド仕様

| サブコマンド | 引数 | 型 | 必須 | 説明 |
|--------------|------|----|------|------|
| `get`  | `key`   | string | × | 特定キーを取得（未指定なら全体） |
| `set`  | `key`   | string | ○ | 設定キー |
|        | `value` | string | ○ | 設定値 |
| `show` | なし    | -      | - | すべての設定を表示 |

#### キー例

- `daily_time`：`"09:00"` のような HH:mm
- `weekly_day`：`"Sun" / "Mon" / ...`
- `timezone`：`"Asia/Tokyo"`
- `summary_channel_id`：Discord チャンネルID

---

## 5. 将来の拡張

### 5-1. `/markov`（将来的実装）

- 役割：学習済みコーパス（自分のログやメモ）から Markov 連鎖で文章を生成。
- サブコマンド候補：
  - `/markov say`：1文生成して発言。
  - `/markov train`：新規コーパスを学習。
- 実装時は `features/markov` として独立ディレクトリ化し、  
  他の機能に影響を与えないようにする。
